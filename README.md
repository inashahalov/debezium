–í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `README.md`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –û–Ω –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

---

# üê≥ PostgreSQL ‚Üí Kafka ‚Üí ClickHouse Pipeline —Å Debezium

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É CDC (Change Data Capture) —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –±–∞–∑–µ **Debezium**, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ PostgreSQL –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö —á–µ—Ä–µ–∑ **Kafka** –≤ **ClickHouse** –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## üîß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –ø–∞–π–ø–ª–∞–π–Ω?

1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ PostgreSQL** —á–µ—Ä–µ–∑ Debezium.
2. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤ Kafka**.
3. **–ß—Ç–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∏–∑ Kafka** —Å –ø–æ–º–æ—â—å—é Python-–∫–æ–Ω—Å—é–º–µ—Ä–∞.
4. **–ó–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π UPDATE –≤ ClickHouse**.
5. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ ClickHouse –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**.

---

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
+-------------+
| PostgreSQL  | ‚Äî‚Äî(CDC)‚Äî‚Äî> [Debezium] ‚Äî‚Äî(Kafka)‚Äî‚Äî> [Python Consumer] ‚Äî‚Äî(HTTP)‚Äî‚Äî> [ClickHouse]
+-------------+
```

---

## üß™ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (`op: "u"`) –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ PostgreSQL.
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ ClickHouse.
- –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse —á–µ—Ä–µ–∑ HTTP API.
- –í—ã–≤–æ–¥ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ ClickHouse –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- [PostgreSQL](https://www.postgresql.org/download/)
- [Kafka](https://kafka.apache.org/downloads)
- [ZooKeeper](https://zookeeper.apache.org/) (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `kraft`)
- [Debezium PostgreSQL Connector](https://debezium.io/documentation/reference/stable/connectors.postgresql.html)
- [ClickHouse](https://clickhouse.com/docs/en/install/)

### Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install kafka-python requests
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ consumer.py               # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç: —á–∏—Ç–∞–µ—Ç Kafka –∏ –ø–∏—à–µ—Ç –≤ ClickHouse
‚îú‚îÄ‚îÄ update_postgres.py        # –ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL
‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1. **–ü–æ–¥–Ω–∏–º–∏—Ç–µ –≤—Å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (Docker Compose —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**  
   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose.yml` —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏: `zookeeper`, `kafka`, `postgres`, `debezium`, `clickhouse`.

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Debezium PostgreSQL Connector**  
   –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω —Å–ª–µ–¥–∏–ª –∑–∞ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ–π `public.my_table`.

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Python-–∫–æ–Ω—Å—é–º–µ—Ä–∞:**

   ```bash
   python consumer.py
   ```

   > –≠—Ç–æ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Kafka –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–µ–∫—É–Ω–¥.

4. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL:**

   ```bash
   python update_postgres.py
   ```

5. **–ù–∞–±–ª—é–¥–∞–π—Ç–µ –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏:**  
   - –°–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka
   - –ó–∞–ø–∏—Å—å –≤ ClickHouse
   - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã ClickHouse

---

## üìä –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse

–¢–∞–±–ª–∏—Ü–∞ `changes` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–∞–∫–∏–µ –ø–æ–ª—è:

| id  | name       | created_at           | op  | ts                  |
|-----|------------|----------------------|-----|---------------------|
| 1   | Alice 5555 | 2024-01-01 00:00:00  | u   | now()               |

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–µ–π—á–∞—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (`op == "u"`). –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥ `insert`, `delete`.
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç `DateTime` ClickHouse.
- –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è Kafka –º–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `consumer.py` –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.

---

## üß† –ì–¥–µ —ç—Ç–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?

- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞—É–¥–∏—Ç –∏–ª–∏ –æ—Ç–ª–∞–¥–∫–∞).
- –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ OLTP –≤ OLAP —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –ë–î.
- –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ ETL-–ø—Ä–æ—Ü–µ—Å—Å—ã.

---

## ‚úÖ –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π (c, u, d).
- –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫.
- –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ClickHouse –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤–º–µ—Å—Ç–æ HTTP.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä—Ç–∏—Ü–∏–π Kafka.

---
